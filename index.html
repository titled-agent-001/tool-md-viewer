<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
<title>YK001 Viewer</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
<style>
:root {
  --bg: #ffffff; --fg: #1a1a2e; --bg2: #f8f9fa; --border: #e0e0e0;
  --accent: #4361ee; --accent-hover: #3a56d4; --code-bg: #f1f3f5;
  --shadow: rgba(0,0,0,0.08); --drop-bg: #f0f4ff; --drop-border: #4361ee;
}
[data-theme="dark"] {
  --bg: #1a1a2e; --fg: #e0e0e0; --bg2: #16213e; --border: #333;
  --accent: #6c8cff; --accent-hover: #5a7aee; --code-bg: #0f1626;
  --shadow: rgba(0,0,0,0.3); --drop-bg: #16213e; --drop-border: #6c8cff;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, 'Noto Sans TC', 'Noto Sans SC', 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', 'PingFang TC', 'PingFang SC', 'Heiti TC', sans-serif;
  background: var(--bg); color: var(--fg); line-height: 1.7;
  transition: background .2s, color .2s;
}
.controls {
  max-width: 860px; margin: 0 auto; padding: 2rem 1.5rem 1rem;
}
header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
header h1 { font-size: 1.5rem; font-weight: 700; }
.header-actions { display: flex; gap: .5rem; }
button {
  padding: .5rem 1rem; border: 1px solid var(--border); border-radius: 6px;
  background: var(--bg2); color: var(--fg); cursor: pointer; font-size: .875rem;
  transition: all .15s;
}
button:hover { border-color: var(--accent); color: var(--accent); }
button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
button.primary:hover { background: var(--accent-hover); }
.dropzone {
  border: 2px dashed var(--border); border-radius: 12px; padding: 3rem 1rem;
  text-align: center; color: #888; transition: all .2s; cursor: pointer;
}
.dropzone.over { border-color: var(--drop-border); background: var(--drop-bg); }
.dropzone p { margin: .25rem 0; }
.dropzone .hint { font-size: .8rem; }
input[type="file"] { display: none; }

#output { max-width: 860px; margin: 0 auto; padding: 0 1.5rem 3rem; }
.file-section { margin-top: 2rem; page-break-before: always; }
.file-section:first-child { page-break-before: auto; }
.file-header {
  font-size: .8rem; font-weight: 600; text-transform: uppercase; letter-spacing: .05em;
  color: var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: .35rem;
  margin-bottom: 1.25rem;
}
/* Markdown rendered content */
.md-content h1 { font-size: 2rem; margin: 1.5rem 0 .75rem; font-weight: 700; border-bottom: 1px solid var(--border); padding-bottom: .3rem; }
.md-content h2 { font-size: 1.5rem; margin: 1.4rem 0 .6rem; font-weight: 600; }
.md-content h3 { font-size: 1.25rem; margin: 1.2rem 0 .5rem; }
.md-content h4, .md-content h5, .md-content h6 { margin: 1rem 0 .4rem; }
.md-content p { margin: .6rem 0; }
.md-content ul, .md-content ol { margin: .5rem 0 .5rem 1.5rem; }
.md-content li { margin: .2rem 0; }
.md-content blockquote {
  border-left: 4px solid var(--accent); margin: 1rem 0; padding: .5rem 1rem;
  background: var(--bg2); border-radius: 0 6px 6px 0;
}
.md-content code {
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; font-size: .875em;
  background: var(--code-bg); padding: .15em .35em; border-radius: 4px;
}
.md-content pre {
  background: var(--code-bg); padding: 1rem; border-radius: 8px;
  overflow-x: auto; margin: 1rem 0; border: 1px solid var(--border);
}
.md-content pre code { background: none; padding: 0; font-size: .85em; }
.md-content table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
.md-content th, .md-content td { border: 1px solid var(--border); padding: .5rem .75rem; text-align: left; }
.md-content th { background: var(--bg2); font-weight: 600; }
.md-content img { max-width: 100%; border-radius: 6px; }
.md-content a { color: var(--accent); }
.md-content hr { border: none; border-top: 1px solid var(--border); margin: 1.5rem 0; }

.empty-state { text-align: center; color: #999; padding: 4rem 1rem; font-size: .95rem; }

@page { margin: 15mm; size: auto; }
@media print {
  .controls { display: none !important; }
  body { background: #fff; color: #000; margin: 0; }
  #output { padding: 0; }
  .file-section { page-break-before: always; }
  .file-section:first-child { page-break-before: auto; }
  .md-content pre { white-space: pre-wrap; word-wrap: break-word; }
  .md-content code { background: #f5f5f5; }
  .md-content blockquote { background: #f9f9f9; }
  .file-header { color: #333; border-color: #333; }
}
@media (max-width: 600px) {
  .controls, #output { padding-left: 1rem; padding-right: 1rem; }
  header { flex-direction: column; align-items: flex-start; gap: .75rem; }
}
</style>
</head>
<body>
<div class="controls">
  <header>
    <h1>ðŸ“„ YK001 Viewer</h1>
    <div class="header-actions">
      <span id="sizeControls" style="display:none;align-items:center;gap:.25rem">
        <button onclick="adjustSize(-1)" title="Smaller text">Aâˆ’</button>
        <span id="sizeLabel" style="font-size:.8rem;min-width:3em;text-align:center">100%</span>
        <button onclick="adjustSize(1)" title="Larger text">A+</button>
      </span>
      <button id="printBtn" class="primary" style="display:none" onclick="window.print()">ðŸ–¨ Print / Save PDF</button>
      <button id="clearBtn" style="display:none" onclick="clearAll()">âœ• Clear</button>
      <button onclick="toggleTheme()" title="Toggle theme">ðŸŒ“</button>
    </div>
  </header>
  <div class="dropzone" id="dropzone">
    <p><strong>Drop .md files here</strong></p>
    <p class="hint">or click to browse</p>
    <input type="file" id="fileInput" accept=".md,.markdown,.txt" multiple>
  </div>
</div>
<div id="output"></div>

<script>
const drop = document.getElementById('dropzone');
const input = document.getElementById('fileInput');
const output = document.getElementById('output');
let fileCount = 0;

marked.setOptions({ breaks: true, gfm: true });

drop.addEventListener('click', () => input.click());
drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('over'); });
drop.addEventListener('dragleave', () => drop.classList.remove('over'));
drop.addEventListener('drop', e => { e.preventDefault(); drop.classList.remove('over'); handleFiles(e.dataTransfer.files); });
input.addEventListener('change', () => { handleFiles(input.files); input.value = ''; });

async function handleFiles(files) {
  const mdFiles = [...files].filter(f => /\.(md|markdown|txt)$/i.test(f.name));
  const results = await Promise.all(mdFiles.map(f => new Promise((resolve) => {
    const reader = new FileReader();
    reader.onload = () => resolve({ name: f.name, text: reader.result });
    reader.readAsText(f);
  })));
  results.forEach(r => addFile(r.name, r.text));
}

function addFile(name, text) {
  const section = document.createElement('div');
  section.className = 'file-section';
  section.innerHTML = `<div class="file-header">${escHtml(name)}</div><div class="md-content">${DOMPurify.sanitize(marked.parse(text))}</div>`;
  output.appendChild(section);
  fileCount++;
  document.getElementById('printBtn').style.display = '';
  document.getElementById('clearBtn').style.display = '';
  document.getElementById('sizeControls').style.display = 'flex';
}

function clearAll() {
  output.innerHTML = ''; fileCount = 0;
  document.getElementById('printBtn').style.display = 'none';
  document.getElementById('clearBtn').style.display = 'none';
  document.getElementById('sizeControls').style.display = 'none';
  const o = document.getElementById('output');
  o.style.zoom = '';
  o.style.maxWidth = '';
  scaleVal = 100;
  document.getElementById('sizeLabel').textContent = '100%';
}

function escHtml(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

function toggleTheme() {
  const t = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
  document.documentElement.dataset.theme = t;
  localStorage.setItem('theme', t);
}
if (localStorage.getItem('theme')) document.documentElement.dataset.theme = localStorage.getItem('theme');

let scaleVal = 100;
function adjustSize(dir) {
  scaleVal = Math.max(50, Math.min(150, scaleVal + dir * 10));
  const el = document.getElementById('output');
  el.style.zoom = scaleVal + '%';
  el.style.maxWidth = (860 / (scaleVal / 100)) + 'px';
  document.getElementById('sizeLabel').textContent = scaleVal + '%';
}
</script>
</body>
</html>
